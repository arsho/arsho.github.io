<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=index,follow><meta name=keywords content=python><meta name=description content="How to run a Python script inside a virtual environment in background that writes partial output to a file"><meta name=author content="Ahmedur Rahman Shovon"><meta property=og:url content=https://arshovon.com/blog/python-background/><meta property=og:type content=website><meta property=og:title content="Run a Python script inside a virtual environment in the background - Ahmedur Rahman Shovon"><meta name=og:description content="How to run a Python script inside a virtual environment in background that writes partial output to a file"><meta property=og:image content=https://arshovon.com/blog/images/python_background.png><meta property=og:image:secure_url content=https://arshovon.com/blog/images/python_background.png><meta property=og:image:type content=image/png><meta property=og:image:alt content="Run a Python script inside a virtual environment in the background - Ahmedur Rahman Shovon"><meta property=og:site_name content="Ahmedur Rahman Shovon"><meta property=og:locale content=en-us><meta name=twitter:card content=summary><meta name=twitter:image content=https://arshovon.com/blog/images/python_background.png><meta name=twitter:url content=https://arshovon.com/blog/python-background/><meta property=twitter:title content="Run a Python script inside a virtual environment in the background - Ahmedur Rahman Shovon"><meta name=twitter:description content="How to run a Python script inside a virtual environment in background that writes partial output to a file"><title>Run a Python script inside a virtual environment in the background - Ahmedur Rahman Shovon</title><link rel=canonical href=https://arshovon.com/blog/python-background/><link rel=icon href=https://arshovon.com/assets/images/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://arshovon.com/assets/images/favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx crossorigin=anonymous><script src=https://kit.fontawesome.com/9c9dff05f4.js crossorigin=anonymous></script><link rel=stylesheet href=https://arshovon.com/assets/css/arsho.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119139307-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-119139307-1');</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4737800736768640" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github-gist.min.css></head><body><header class="header mb-md-4 mb-lg-4 mb-xl-4"><nav class="navbar navbar-expand-md navbar-light bg-white text-dark" aria-label=site_top_menu><div class="container px-md-0"><a class=navbar-brand href=/>AR Shovon</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#site_top_menu aria-controls=site_top_menu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=site_top_menu><ul class="navbar-nav me-auto mb-2 mb-md-0"><li class=nav-item><a class=nav-link title="Blog posts" href=/blog><i class="fa fa-laptop-code fa-lg me-1"></i>Blog</a></li><li class=nav-item><a class=nav-link title=Snippets href=/snippets><i class="fa fa-code fa-lg me-1"></i>Snippets</a></li><li class=nav-item><a class=nav-link title=Apps href=/apps><i class="fa fa-globe fa-lg me-1"></i>Apps</a></li><li class=nav-item><a class=nav-link title="All categories" href=/categories><i class="fa fa-folder-open fa-lg me-1"></i>Categories</a></li><li class=nav-item><a class=nav-link title="All tags" href=/tags><i class="fa fa-tags fa-lg me-1"></i>Tags</a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link title="Linkedin profile" href=https://www.linkedin.com/in/arshovon/><i class="fab fa-linkedin fa-lg me-1"></i>arshovon</a></li><li class=nav-item><a class=nav-link title="Stackoverflow profile" href=https://stackoverflow.com/users/3129414/arsho><i class="fab fa-stack-overflow fa-lg me-1"></i>arsho</a></li><li class=nav-item><a class=nav-link title="Github profile" href=https://github.com/arsho/><i class="fab fa-github fa-lg me-1"></i>arsho</a></li><li class=nav-item><a class=nav-link title="View CV" href=/cv/CV_Shovon.pdf><i class="fas fa-file-pdf fa-lg me-1"></i>CV</a></li></ul></div></div></nav></header><div class="container wrapper bg-white shadow"><div class=row><main class="col-12 blog p-3 p-md-5" role=main><article><header class="mb-5 text-bg-light pt-md-5 px-md-5 pb-md-2 article-header"><h3 class="pt-5 fs-3 text-center">Run a Python script inside a virtual environment in the background</h3><p class="lead text-center mb-5 text-muted">Author:
Ahmedur Rahman Shovon</p><div class="mb-1 clearfix"><small class="float-lg-end d-block d-lg-inline text-muted">Published on
<time datetime=2022-03-18T03:03:14-05:00><i class="fa fa-calendar pe-1"></i>March 18, 2022</time>
, Updated on
<time datetime=2022-09-05T01:24:47-05:00><i class="fa fa-calendar pe-1"></i>September 5, 2022</time></small>
<a href=https://arshovon.com/categories/ class="badge text-bg-secondary me-1" title="All categories"><i class="fa fa-folder-open"></i></a><a href=https://arshovon.com/categories/python class="badge text-bg-secondary" title=python>python</a>
<a href=https://arshovon.com/categories/high-performance-computing class="badge text-bg-secondary" title="high-performance computing">high-performance computing</a>
<a href=https://arshovon.com/tags/ class="badge text-bg-secondary me-1" title="All tags"><i class="fa fa-tags"></i></a><a href=https://arshovon.com/tags/python class="badge text-bg-secondary" title=python>python</a></div></header><h3 id=scenario>Scenario</h3><p>Suppose, we have a Python script that uses some Python packages.
To keep the global environment clean, we use a virtual environment (<code>venv</code>) to install the dependencies.
Let's assume, the script requires a long time to finish.
We may need to check the intermediate results (e.g. print statement debugging) from the script during the execution process.
We also want to run the script in the background without blocking a terminal window.</p><p>I will mock this scenario and will show how to run the Python script inside a virtual environment in the background that writes partial output to a file.</p><h3 id=running-script-in-the-foreground>Running script in the foreground</h3><ul><li><p>Create and activate virtual environment using Python 3:</p><pre><code>python3 -m venv venv
source venv/bin/activate
</code></pre></li><li><p>Suppose the required packages are listed in <code>requirements.txt</code>:</p><pre><code>numpy==1.22.3
</code></pre></li><li><p>Install the required packages:</p><pre><code>pip install -r requirements.txt
</code></pre></li><li><p>Create a Python script that generates 3 random integers and sleep for 5 seconds at each step. It continues the process until 30 integers are generated. The code is listed in <code>background_script.py</code> file:</p><pre><code>import time
from datetime import datetime
import numpy as np
    
count = 0
while True:
    current_time = datetime.now()
    rng = np.random.default_rng()
    random_integers = rng.integers(low=0, high=10 ** 6, size=3)
    print(f&quot;{current_time}: {random_integers}&quot;)
    count += 1
    if count == 10:
        print(f&quot;Script completed&quot;)
        break
    time.sleep(5)
</code></pre></li><li><p>Run the Python script (<code>background_script.py</code>):</p><pre><code>python background_script.py
</code></pre></li><li><p>It shows 3 random numbers continuously each 5 seconds.
The script takes 50 seconds to complete and will stop after printing 30 random numbers:</p><pre><code>2022-03-18 04:18:12.376506: [874273 493185 580873]
2022-03-18 04:18:17.378234: [175390 989369 463402]
2022-03-18 04:18:22.382138: [721299 669516 197204]
2022-03-18 04:18:27.386138: [537835 627442 400862]
...
...
Script completed
</code></pre></li></ul><h3 id=running-script-using-bash-in-the-background>Running script using Bash in the background</h3><ul><li><p>Let's create a Shell script (<code>run_bg.sh</code>) in the same directory that activates the virtual environment and runs the Python script. We have used <code>-u</code> parameter in the Python run command that enables printing the partial outputs to the standard output:</p><pre><code>#!/usr/bin/env bash
set -e
source &quot;./venv/bin/activate&quot;
python -u background_script.py
</code></pre></li><li><p>Run the script in the foreground to check if it can activate the virtual environment and runs the Python script:</p><pre><code>./run_bg.sh
</code></pre></li><li><p>If the above Shell script runs without error, we try to run it in a background process using <code>nohup</code> command. This will write the partial outputs to a file (<code>custom-output.log</code>):</p><pre><code>nohup ./run_bg.sh &gt; custom-output.log &amp;
</code></pre></li><li><p>We can see the partial output using:</p><pre><code>cat custom-output.log
</code></pre><p><figure><img src=/blog/images/python_background.png alt="alt Run Python Script in background with partial output"></figure></p></li><li><p>Sometimes we may need to stop the script running in the background. We need to kill the process which runs the script to do so. The following command will list the process ID for the script:</p><pre><code>ps aux | grep background_script.py
</code></pre><p>It will return the process details which contain the process ID, typically in the second column.
Then we can kill the process by using:</p><pre><code>kill PROCESS_ID
</code></pre></li></ul><h3 id=use-case>Use case</h3><p>I was trying to run a hefty Python script that requires a virtual environment in a cluster computing platform.
I did not want to keep the terminal session open as the script would take days to finish.
I also wanted to see the partial output while the script was running.</p><p>So, I followed this approach to run the Python script inside a virtual environment in the background that wrote the partial output to a file.</p><h3 id=references>References</h3><ul><li><a href=https://man7.org/linux/man-pages/man1/sh.1p.html>sh command man page</a></li><li><a href=https://man7.org/linux/man-pages/man1/nohup.1.html>nohup(1) — Linux manual page</a></li></ul><div class="col-12 my-4 pb-4 border-top border-bottom"><p class="text-muted text-center"><small>Advertisement</small></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4737800736768640" crossorigin=anonymous></script><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4737800736768640 data-ad-slot=3931195519></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></article><h5 class="mb-2 mt-4">Cite This Work</h5><dl class="text-left mb-4"><dt class=pb-1>APA Style</dt><dd class="pl-4 pb-2">Shovon, A. R.
(2022, March 18).
<i>Run a Python script inside a virtual environment in the background</i>.
Ahmedur Rahman Shovon.
Retrieved September 5, 2022, from
<a href=https://arshovon.com/blog/python-background/>https://arshovon.com/blog/python-background/</a></dd><dt class=pb-1>MLA Style</dt><dd class="pl-4 pb-2">Shovon, Ahmedur Rahman.
“Run a Python script inside a virtual environment in the background.”
<i>Ahmedur Rahman Shovon</i>,
18 Mar. 2022.
Web.
5 Sep. 2022.
<a href=https://arshovon.com/blog/python-background/>https://arshovon.com/blog/python-background/</a>.</dd><dt class=pb-1>BibTeX entry</dt><dd class="pl-4 pb-2"><pre>
@misc{ shovon_2022,
    author = "Shovon, Ahmedur Rahman",
    title = "Run a Python script inside a virtual environment in the background",
    year = "2022",
    url = "https://arshovon.com/blog/python-background/",
    note = "[Online; accessed 5-September-2022; URL: https://arshovon.com/blog/python-background/]"
}
</pre></dd></dl><h5 class="mb-2 mt-4">Related Contents in this Website</h5><div class=card-group><div class=card><div class=card-body><a href=https://arshovon.com/blog/cudf-vs-df/ class=card-title>cuDF vs Pandas dataframe performance comparison</a></div><div class=card-footer><span class="text_muted small"><a href=https://arshovon.com/categories/python class="badge text-bg-secondary" title=python><i class="fa fa-folder-open"></i>python</a>
<a href=https://arshovon.com/categories/high-performance-computing class="badge text-bg-secondary" title="high-performance computing"><i class="fa fa-folder-open"></i>high-performance computing</a>
<a href=https://arshovon.com/categories/gpgpu class="badge text-bg-secondary" title=gpgpu><i class="fa fa-folder-open"></i>gpgpu</a></span></div></div><div class=card><div class=card-body><a href=https://arshovon.com/blog/sorting-a-list-python3/ class=card-title>Sorting a list (Python 3)</a></div><div class=card-footer><span class="text_muted small"><a href=https://arshovon.com/categories/python class="badge text-bg-secondary" title=python><i class="fa fa-folder-open"></i>python</a></span></div></div></div><div class="row row-cols-1 row-cols-md-2 g-4 mt-2"><div class=col><div class="card mb-3 bg-light border-light"><div class=card-body><h5 class=card-title><i class="fa fa-chevron-left pe-1"></i>Previous Post</h5><p class=card-text><a href=https://arshovon.com/blog/sorting-a-list-python3/ class="pt-2 pb-2">Sorting a list (Python 3)</a></p></div><div class=card-footer><span class="text_muted small"><time datetime=2022-01-16T07:01:32-06:00><i class="fa fa-calendar pe-1"></i>January 16, 2022</time></span></div></div></div><div class=col><div class="card mb-3 bg-light text-md-end border-light"><div class=card-body><h5 class=card-title>Next Post <i class="fa fa-chevron-right pe-1"></i></h5><p class=card-text><a href=https://arshovon.com/blog/cudf-vs-df/ class="pt-2 pb-2">cuDF vs Pandas dataframe performance comparison</a></p></div><div class=card-footer><span class="text_muted small"><time datetime=2022-08-01T08:01:14-05:00><i class="fa fa-calendar pe-1"></i>August 1, 2022</time></span></div></div></div></div><div class="shadow-lg row p-0 m-0 mt-4 footer-profile"><div class="offset-lg-4 col-lg-8 m-auto p-lg-2"><div class="card border-0"><div class="card-body py-0 my-0"><div class=row><div class=col-md-2><img src=https://arshovon.com/assets/images/shovon.png class="shadow-sm img-thumbnail" alt="Ahmedur Rahman Shovon"></div><div class="col-md-10 my-auto mx-md-0 px-md-0"><h5 class="card-title m-0 p-0"><small><a href=/>Ahmedur Rahman Shovon</a></small></h5><small class="well m-0 p-0">Ph.D Student (Computer Science)
at
<a href=https://www.uab.edu/ title="University of Alabama at Birmingham">University of Alabama at Birmingham</a></small><ul class="list-inline m-md-0 p-md-0"><li class=list-inline-item><small><i class="fas fa-graduation-cap fa-fw mr-1"></i><a href="https://scholar.google.com/citations?hl=en&amp;user=6yvWyoYAAAAJ" title="Google Scholar Citation Profile">Ahmedur Rahman Shovon</a></small></li><li class=list-inline-item><small><i class="fab fa-linkedin fa-fw mr-1"></i><a href=https://www.linkedin.com/in/arshovon/ title="Linkedin profile">arshovon</a></small></li><li class=list-inline-item><small><i class="fab fa-stack-overflow fa-fw mr-1"></i><a href=https://stackoverflow.com/users/3129414/arsho title="Stackoverflow profile">arsho</a></small></li><li class=list-inline-item><small><i class="fab fa-github fa-fw mr-1"></i><a href=https://github.com/arsho/ title="Github profile">arsho</a></small></li><li class=list-inline-item><small><i class="fab fa-hackerrank fa-fw mr-1"></i><a href=https://www.hackerrank.com/arsho title="Hackerrank profile">arsho</a></small></li></ul></div></div></div></div></div></div></main></div></div><footer class=footer><div class=text-center><small><a href=/privacy>Privacy Policy</a><br>Developed with <i class="fas fa-heart datamate_red me-1"></i>by <a href=https://arshovon.com/ title="Ahmedur Rahman Shovon">Ahmedur Rahman Shovon</a></small></div></footer><div id=back-to-top class="sticky-bottom float-end d-inline d-none"><button class="btn m-0 p-0 text-secondary" data-bs-toggle=tooltip data-bs-placement=top data-bs-title="Go to top">
<span class="fa-stack me-md-0 pe-md-0"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-arrow-up fa-stack-1x fa-inverse"></i></span></button></div><script defer src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js integrity=sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa crossorigin=anonymous></script><script defer src=https://arshovon.com/assets/js/arsho.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>